## Этап 2

## Работа по курсу "Рефакторинг баз данных и приложений"
Выбран сценарий 1: Проектирование и разработка новой программной системы

Состав команды:
* Кравцова К.В, P34081
* Батомункуева В.Ж, P34101

Университет ИТМО, факультет ПИиКТ

г. Санкт-Петербург, 2025 год

## Описание проекта
https://github.com/themyav/flat-manager/blob/main/README.md

## Задачи этапа
1. Расширение функциональности проекта
2. Исправление ошибок этапа 1


### База данных
#### Добавление новой таблицы
* **«utility_payment»** отвечает за информацию о конкретной оплате коммунальной услуги:
    * Дата оплаты
    * Признак «Оплачено/не оплачено»
    * Внешний ключ на услугу в таблице «utility»
    * Цена
#### Изменение таблицы «utility»
* Добевлена колонка **payment_url**
  * Ссылка на сервис/сайт, по которому надо произвести оплату

#### ER-диаграмма:
![image](https://github.com/user-attachments/assets/f365b2a3-b35f-417d-a85b-a7688eb2fc5a)

### Back-end

#### Расширение функционала
* Управление сущностями UtilityPayment, обозначающие оплату коммунальной услуги в конкретном месяце
    * Получение списка услуг для оплаты в конкретном месяц
    * Изменение состояния услуги с неоплаченной на оплаченную
    * Создание списка услуг, которые нужно оплатить, каждое 1-е число нового месяца по таймеру
    * Создание сущности UtilityPayment для текущего месяца при создании новой сущности Utility

* Модификация сущности Utility
    * Добавление поля paymentURL, укащывающего на сайт с оплатой
    * Добавление связи с сушностью UtilityPayment

#### Исправление функционала
* Рефакторинг имен методов, изменение некорректных имен в контроллерах

### Front-end

#### Расширение функционала
* Добавление навигации по месяцам, выбора месяца и года для отображения чеклиста
* Логика обработки нажатий в чеклисте, посчет того, сколько КУ осталось оплатить
* Добавление форм редактирования расширенной сущности КУ (Utility) и пользователя

#### Исправление функционала
* Исправление некорректно отображающихся дат

### Aglie

Была использована система мониторинга проектов YouTrack. Задачи этапа 2:

<img src="https://github.com/user-attachments/assets/71e7fa33-8d92-402d-9ca6-41aa0a7e9339" alt="Image description" width="50%">

## Результат работы

### Исходный код этапа 2

Pull Request отображает diff в коде между 1 и 2 этапом.

https://github.com/themyav/flat-manager/pull/19

### Редактирование данных профиля пользователя

Перейдем к редактированию пользователя

<img src="https://github.com/user-attachments/assets/66837c66-087b-4232-a46b-ac6a895adcb0" alt="Image description" width="50%">

Заполним новые данные

<img src="https://github.com/user-attachments/assets/379b3697-4751-4a10-88c2-b03ddc1837ed" alt="Image description" width="50%">

Новая информация отобразится на сайте

<img src="https://github.com/user-attachments/assets/2bef61fa-1cde-4054-83fc-06618ee492d8" alt="Image description" width="50%">

Новый пользователь отобразится в БД

<img src="https://github.com/user-attachments/assets/1334432b-2373-483b-aab4-c0ba3721c27b" alt="Image description" width="50%">

### Редактирование данных коммунальной услуги (с учетом новых полей)

Перейдем на страницу КУ

<img src="https://github.com/user-attachments/assets/7f8ffae7-2a05-4261-bc91-9fc7f3caef1f" alt="Image description" width="50%">

Изменим данные о КУ

<img src="https://github.com/user-attachments/assets/01af4e6c-64fd-4991-aca1-4848e408974e" alt="Image description" width="50%">

Данные обновятся на сайте

<img src="https://github.com/user-attachments/assets/2c2360dd-5f99-4c88-bfb4-15c0535b580a" alt="Image description" width="50%">

И в БД

<img src="https://github.com/user-attachments/assets/05b6c6d9-9ce0-4251-9247-1e3647dfe24c" alt="Image description" width="50%">


### Навигация по месяцам

Установленные чекбоксы показывают, была ли оплачена услуга.

Текущий месяц

<img src="https://github.com/user-attachments/assets/3d28005a-9f44-40fe-bac6-e9e25804a6e2" alt="Image description" width="50%">

Месяц из будущего (услуг еще нет)

<img src="https://github.com/user-attachments/assets/fd1bdfbc-7421-4457-ab0b-62676a88c7f7" alt="Image description" width="50%">

## Вывод

На 2 этапе мы успешно расширили функциональность приложения Flat-Manager как на стороне back-end, так и на front-end, а также исправили ошибки, выявленные на первом этапе. В результате проведенных работ приложение получило значительное расширение функционала и стало более удобным в использовании.
